@page "/admin/categories/edit/{id:long}"
@page "/admin/categories/create"
@inherits OwningComponentBase<ICategoryRepository>

<style>
	div.validation-message {
		color: rgb(220, 53, 69);
		font-weight: 500
	}
</style>

<h3 class="bg-@ThemeColor text-white text-center p-1">@TitleText категорий</h3>
<EditForm Model="Category" OnValidSubmit="SaveCategory">
	<DataAnnotationsValidator />
	@if (Category!.ID != 0)
	{
		<div class="form-group">
			<label>ID</label>
			<input class="form-control" disabled value="@Category.ID" />
		</div>
	}
	<div class="form-group">
		<label>Название категории</label>
		<ValidationMessage For="@(() => Category.CategoryName)" />
		<InputText class="form-control" @bind-Value="Category.CategoryName" />
	</div>
	<div class="form-group">
		<img class="img-fluid" style="height: 250px;" src=@Category.CategoryImg>
		<label>Изображение</label>
		<ValidationMessage For="@(() => Category.CategoryImg)" />
		<InputText class="form-control" @bind-Value="Category.CategoryImg" />
	</div>
	<div class="form-group">
		<label>ID родительской категории</label>
		<ValidationMessage For="@(() => Category.ParentID)" />
		<InputNumber class="form-control" @bind-Value="Category.ParentID" />
	</div>
	<div class="form-group">
		<label>Описание категории</label>
		<ValidationMessage For="@(() => Category.Description)" />
		<InputTextArea class="form-control" @bind-Value="Category.Description" />
	</div>
	<div class="form-group">
		<label>Заголовок 2го блока</label>
		<InputText class="form-control" @bind-Value="Category.HeadingTwo" />
	</div>
	<div class="form-group">
		<img class="img-fluid" style="height: 250px;" src=@Category.ImgTwoUrl>
		<label>Картинка для 2го блока</label>
		<InputText class="form-control" @bind-Value="Category.ImgTwoUrl" />
	</div>
	<div class="form-group">
		<label>Описнаие для 2го блока</label>
		<InputTextArea class="form-control" @bind-Value="Category.DescriptionTwo" />
	</div>
	<div class="form-group">
		<label>Заголовок 3го блока</label>
		<InputText class="form-control" @bind-Value="Category.HeadingThree" />
	</div>
	<div class="form-group">
		<label>Картинка для 3го блока</label>
		<img class="img-fluid" style="height: 250px;" src=@Category.ImgThreeUrl>
		<InputText class="form-control" @bind-Value="Category.ImgThreeUrl" />
	</div>
	<div class="form-group">
		<label>Описнаие для 3го блока</label>
		<InputTextArea class="form-control" @bind-Value="Category.DescriptionThree" />
	</div>
	<div class="form-group">
		@if ( Category?.Slider != string.Empty )
		{
			var slider = Category?.Slider?.Split(',').ToList();
			@foreach (var sl in slider ?? new List<string>())
			{
				<img class="img-thumbnail col-2" src=@sl>
			}
		}
		<label>Слайдер картинок</label>
		<InputTextArea class="form-control" @bind-Value="Category!.Slider" />
	</div>
	<div class="form-group">
		<label>Показывать слайдер</label>
		<InputCheckbox class="" @bind-Value="Category.DisplaySlider" />
	</div>
	<div class="form-group">
		<label>Показывать на главной</label>
		<InputCheckbox class="" @bind-Value="Category.DisplayHomePage" />
	</div>
	<div class="mt-2">
		<button type="submit" class="btn btn-@ThemeColor">Сохранить</button>
		<NavLink class="btn btn-secondary" href="/admin/categories">Отмена</NavLink>
	</div>
</EditForm>

@code {

	public ICategoryRepository Repository => Service;

	[Inject]
	public NavigationManager? NavManager { get; set; }

	[Parameter]
	public long Id { get; set; } = 0;
	public Category Category { get; set; } = new Category();
	

	protected override void OnParametersSet()
	{
		if (Id != 0)
		{
			Category = Repository.Categorys.FirstOrDefault(с => с.ID == Id) ?? new();
		}
	}

	public void SaveCategory()
	{
		if (Id == 0)
		{
			Repository.CreateCategory(Category);
		}
		else
		{
			Repository.SaveCategory(Category);
		}
		NavManager?.NavigateTo("/admin/categories");
	}

	public string ThemeColor => Id == 0 ? "primary" : "warning";
	public string TitleText => Id == 0 ? "Создание" : "Редактирование";
}
